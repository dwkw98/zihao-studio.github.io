<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>9æ ¼åå®¹é“ - æ’è¡Œæ¦œç‰ˆ</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Microsoft YaHei', Arial, sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			display: flex;
			justify-content: center;
			align-items: center;
			padding: 20px;
		}

		.container {
			background: white;
			border-radius: 20px;
			box-shadow: 0 20px 40px rgba(0,0,0,0.1);
			padding: 30px;
			max-width: 1200px;
			width: 100%;
		}

		h1 {
			text-align: center;
			color: #333;
			margin-bottom: 30px;
			font-size: 2.5em;
		}

		.game-wrapper {
			display: flex;
			gap: 40px;
			flex-wrap: wrap;
			justify-content: center;
		}

		.game-area {
			flex: 1;
			min-width: 300px;
			max-width: 500px;
		}

		.puzzle-board {
			width: 100%;
			max-width: 400px;
			margin: 0 auto 20px;
			position: relative;
			background: #f0f0f0;
			border-radius: 10px;
			padding: 10px;
			box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
		}

		.puzzle-grid {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 5px;
			aspect-ratio: 1;
		}

		.tile {
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: white;
			font-size: 2em;
			font-weight: bold;
			display: flex;
			justify-content: center;
			align-items: center;
			border-radius: 10px;
			cursor: pointer;
			transition: all 0.3s ease;
			box-shadow: 0 4px 10px rgba(0,0,0,0.2);
			user-select: none;
		}

		.tile:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 15px rgba(0,0,0,0.3);
		}

		.tile.empty {
			background: transparent;
			box-shadow: none;
			cursor: default;
		}

		.tile.empty:hover {
			transform: none;
		}

		.controls {
			text-align: center;
			margin-bottom: 20px;
		}

		.timer {
			font-size: 1.5em;
			font-weight: bold;
			color: #333;
			margin-bottom: 15px;
			text-align: center;
		}

		.btn {
			background: #667eea;
			color: white;
			border: none;
			padding: 12px 30px;
			font-size: 1.1em;
			border-radius: 25px;
			cursor: pointer;
			transition: all 0.3s ease;
			margin: 0 10px;
			box-shadow: 0 4px 10px rgba(0,0,0,0.2);
		}

		.btn:hover {
			background: #764ba2;
			transform: translateY(-2px);
			box-shadow: 0 6px 15px rgba(0,0,0,0.3);
		}

		.btn:disabled {
			background: #ccc;
			cursor: not-allowed;
			transform: none;
		}

		.leaderboard {
			flex: 1;
			min-width: 300px;
			max-width: 400px;
			background: #f8f9fa;
			border-radius: 15px;
			padding: 25px;
			box-shadow: 0 4px 15px rgba(0,0,0,0.1);
		}

		.leaderboard h2 {
			color: #333;
			margin-bottom: 20px;
			text-align: center;
			font-size: 1.8em;
		}

		.leaderboard-list {
			list-style: none;
		}

		.leaderboard-item {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 12px;
			margin-bottom: 10px;
			background: white;
			border-radius: 10px;
			box-shadow: 0 2px 5px rgba(0,0,0,0.1);
			transition: all 0.3s ease;
		}

		.leaderboard-item:hover {
			transform: translateX(5px);
		}

		.rank {
			font-size: 1.2em;
			font-weight: bold;
			width: 30px;
		}

		.rank-1 { color: #ffd700; }
		.rank-2 { color: #c0c0c0; }
		.rank-3 { color: #cd7f32; }

		.player-name {
			flex: 1;
			font-weight: 500;
			color: #333;
		}

		.player-time {
			font-weight: bold;
			color: #667eea;
		}

		.player-date {
			font-size: 0.8em;
			color: #999;
		}

		.modal {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0,0,0,0.5);
			z-index: 1000;
			justify-content: center;
			align-items: center;
		}

		.modal-content {
			background: white;
			padding: 30px;
			border-radius: 15px;
			text-align: center;
			max-width: 400px;
			width: 90%;
			box-shadow: 0 10px 30px rgba(0,0,0,0.3);
		}

		.modal h3 {
			margin-bottom: 20px;
			color: #333;
		}

		.modal input {
			width: 100%;
			padding: 12px;
			font-size: 1.1em;
			border: 2px solid #ddd;
			border-radius: 8px;
			margin-bottom: 20px;
			transition: border-color 0.3s ease;
		}

		.modal input:focus {
			outline: none;
			border-color: #667eea;
		}

		.victory-message {
			background: linear-gradient(135deg, #4caf50, #45a049);
			color: white;
			padding: 20px;
			border-radius: 10px;
			margin-bottom: 20px;
			text-align: center;
			font-size: 1.2em;
			display: none;
		}

		.current-player {
			background: #e3f2fd;
			padding: 15px;
			border-radius: 10px;
			margin-bottom: 20px;
			text-align: center;
			border-left: 5px solid #2196f3;
		}

		.current-player .label {
			font-weight: bold;
			color: #2196f3;
			margin-bottom: 5px;
		}

		@media (max-width: 768px) {
			.game-wrapper {
				flex-direction: column;
			}
			
			.tile {
				font-size: 1.5em;
			}
			
			h1 {
				font-size: 2em;
			}
		}
	</style>
</head>
<body>
	<div class="container">
		<h1>ğŸ”® 9æ ¼åå®¹é“</h1>
		
		<div class="current-player" id="currentPlayerInfo" style="display: none;">
			<div class="label">å½“å‰ç©å®¶</div>
			<div id="playerNameDisplay"></div>
		</div>

		<div class="victory-message" id="victoryMessage">
			ğŸ‰ æ­å–œå®Œæˆï¼ç”¨æ—¶ <span id="finalTime"></span> ğŸ‰
		</div>

		<div class="game-wrapper">
			<div class="game-area">
				<div class="timer" id="timer">æ—¶é—´: 00:00</div>
				
				<div class="puzzle-board">
					<div class="puzzle-grid" id="puzzleGrid"></div>
				</div>
				
				<div class="controls">
					<button class="btn" id="shuffleBtn" onclick="shufflePuzzle()">æ‰“ä¹±é‡æ’</button>
					<button class="btn" id="resetBtn" onclick="resetPuzzle()">é‡æ–°å¼€å§‹</button>
				</div>
			</div>
			
			<div class="leaderboard">
				<h2>ğŸ† æ’è¡Œæ¦œ</h2>
				<ul class="leaderboard-list" id="leaderboardList">
					<li style="text-align: center; color: #999; padding: 20px;">
						æš‚æ— è®°å½•ï¼Œå¿«æ¥åˆ›é€ ç¬¬ä¸€ä¸ªè®°å½•å§ï¼
					</li>
				</ul>
			</div>
		</div>
	</div>

	<!-- ç©å®¶åç§°è¾“å…¥æ¨¡æ€æ¡† -->
	<div class="modal" id="nameModal">
		<div class="modal-content">
			<h3>æ¬¢è¿ï¼è¯·è¾“å…¥ä½ çš„å¤§å</h3>
			<p style="color: #666; margin-bottom: 20px; font-size: 0.9em;">
				ä½ çš„æˆç»©å°†è¢«è®°å½•åˆ°æ’è¡Œæ¦œä¸­
			</p>
			<input type="text" id="playerNameInput" placeholder="è¾“å…¥ä½ çš„åç§°..." maxlength="20">
			<button class="btn" onclick="savePlayerName()">å¼€å§‹æ¸¸æˆ</button>
		</div>
	</div>

	<script>
		// æ¸¸æˆçŠ¶æ€
		let tiles = [];
		let emptyPos = 8;
		let isPlaying = false;
		let startTime = null;
		let timerInterval = null;
		let playerName = localStorage.getItem('puzzlePlayerName');
		let leaderboard = JSON.parse(localStorage.getItem('puzzleLeaderboard') || '[]');

		// åˆå§‹åŒ–
		window.onload = function() {
			initPuzzle();
			renderLeaderboard();
			
			// æ£€æŸ¥æ˜¯å¦éœ€è¦è¾“å…¥ç©å®¶åç§°
			if (!playerName) {
				document.getElementById('nameModal').style.display = 'flex';
				document.getElementById('playerNameInput').focus();
			} else {
				showPlayerInfo();
			}
		};

		// åˆå§‹åŒ–æ‹¼å›¾
		function initPuzzle() {
			tiles = [1, 2, 3, 4, 5, 6, 7, 8, ''];
			emptyPos = 8;
			renderPuzzle();
		}

		// æ¸²æŸ“æ‹¼å›¾
		function renderPuzzle() {
			const grid = document.getElementById('puzzleGrid');
			grid.innerHTML = '';
			
			tiles.forEach((tile, index) => {
				const tileElement = document.createElement('div');
				tileElement.className = tile === '' ? 'tile empty' : 'tile';
				tileElement.textContent = tile;
				tileElement.onclick = () => moveTile(index);
				grid.appendChild(tileElement);
			});
		}

		// ç§»åŠ¨æ–¹å—
		function moveTile(index) {
			if (!isPlaying) return;
			
			const row = Math.floor(index / 3);
			const col = index % 3;
			const emptyRow = Math.floor(emptyPos / 3);
			const emptyCol = emptyPos % 3;
			
			// æ£€æŸ¥æ˜¯å¦ç›¸é‚»
			const isAdjacent = (Math.abs(row - emptyRow) === 1 && col === emptyCol) ||
							 (Math.abs(col - emptyCol) === 1 && row === emptyRow);
			
			if (isAdjacent) {
				// äº¤æ¢ä½ç½®
				[tiles[index], tiles[emptyPos]] = [tiles[emptyPos], tiles[index]];
				emptyPos = index;
				renderPuzzle();
				
				// æ£€æŸ¥æ˜¯å¦è·èƒœ
				if (checkWin()) {
					handleWin();
				}
			}
		}

		// æ£€æŸ¥æ˜¯å¦è·èƒœ
		function checkWin() {
			for (let i = 0; i < 8; i++) {
				if (tiles[i] !== i + 1) return false;
			}
			return tiles[8] === '';
		}

		// æ‰“ä¹±æ‹¼å›¾ï¼ˆç¡®ä¿å¯è§£ï¼‰
		function shufflePuzzle() {
			// ç”Ÿæˆå¯è§£çš„æ‰“ä¹±çŠ¶æ€
			do {
				tiles = [1, 2, 3, 4, 5, 6, 7, 8, ''];
				emptyPos = 8;
				
				// è¿›è¡Œ1000æ¬¡éšæœºç§»åŠ¨ç¡®ä¿å¯è§£
				for (let i = 0; i < 1000; i++) {
					const possibleMoves = getPossibleMoves();
					const randomMove = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
					[tiles[randomMove], tiles[emptyPos]] = [tiles[emptyPos], tiles[randomMove]];
					emptyPos = randomMove;
				}
			} while (checkWin()); // ç¡®ä¿æ‰“ä¹±çš„æ‹¼å›¾ä¸æ˜¯å·²è§£å†³çŠ¶æ€
			
			renderPuzzle();
			startTimer();
		}

		// è·å–å¯ç§»åŠ¨çš„ä½ç½®
		function getPossibleMoves() {
			const moves = [];
			const row = Math.floor(emptyPos / 3);
			const col = emptyPos % 3;
			
			if (row > 0) moves.push(emptyPos - 3); // ä¸Š
			if (row < 2) moves.push(emptyPos + 3); // ä¸‹
			if (col > 0) moves.push(emptyPos - 1); // å·¦
			if (col < 2) moves.push(emptyPos + 1); // å³
			
			return moves;
		}

		// å¼€å§‹è®¡æ—¶
		function startTimer() {
			if (timerInterval) clearInterval(timerInterval);
			startTime = Date.now();
			isPlaying = true;
			document.getElementById('victoryMessage').style.display = 'none';
			
			timerInterval = setInterval(() => {
				const elapsed = Math.floor((Date.now() - startTime) / 1000);
				const minutes = Math.floor(elapsed / 60);
				const seconds = elapsed % 60;
				document.getElementById('timer').textContent = 
					`æ—¶é—´: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
			}, 100);
			
			document.getElementById('shuffleBtn').disabled = true;
		}

		// å¤„ç†è·èƒœ
		function handleWin() {
			clearInterval(timerInterval);
			isPlaying = false;
			const elapsed = Math.floor((Date.now() - startTime) / 1000);
			const minutes = Math.floor(elapsed / 60);
			const seconds = elapsed % 60;
			const timeStr = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
			
			document.getElementById('finalTime').textContent = timeStr;
			document.getElementById('victoryMessage').style.display = 'block';
			document.getElementById('shuffleBtn').disabled = false;
			
			// ä¿å­˜æˆç»©
			if (playerName) {
				saveScore(playerName, elapsed);
			}
		}

		// é‡ç½®æ‹¼å›¾
		function resetPuzzle() {
			clearInterval(timerInterval);
			isPlaying = false;
			document.getElementById('timer').textContent = 'æ—¶é—´: 00:00';
			document.getElementById('victoryMessage').style.display = 'none';
			document.getElementById('shuffleBtn').disabled = false;
			initPuzzle();
		}

		// ä¿å­˜ç©å®¶åç§°
		function savePlayerName() {
			const name = document.getElementById('playerNameInput').value.trim();
			if (name && name.length > 0) {
				playerName = name;
				localStorage.setItem('puzzlePlayerName', playerName);
				document.getElementById('nameModal').style.display = 'none';
				showPlayerInfo();
			} else {
				alert('è¯·è¾“å…¥æœ‰æ•ˆçš„åç§°ï¼');
			}
		}

		// æ˜¾ç¤ºç©å®¶ä¿¡æ¯
		function showPlayerInfo() {
			const info = document.getElementById('currentPlayerInfo');
			info.style.display = 'block';
			document.getElementById('playerNameDisplay').textContent = playerName;
		}

		// ä¿å­˜æˆç»©
		function saveScore(name, time) {
			const score = {
				name: name,
				time: time,
				date: new Date().toISOString()
			};
			
			leaderboard.push(score);
			leaderboard.sort((a, b) => a.time - b.time);
			leaderboard = leaderboard.slice(0, 50); // åªä¿ç•™å‰50å
			
			localStorage.setItem('puzzleLeaderboard', JSON.stringify(leaderboard));
			renderLeaderboard();
		}

		// æ¸²æŸ“æ’è¡Œæ¦œ
		function renderLeaderboard() {
			const list = document.getElementById('leaderboardList');
			list.innerHTML = '';
			
			if (leaderboard.length === 0) {
				list.innerHTML = '<li style="text-align: center; color: #999; padding: 20px;">æš‚æ— è®°å½•ï¼Œå¿«æ¥åˆ›é€ ç¬¬ä¸€ä¸ªè®°å½•å§ï¼</li>';
				return;
			}
			
			leaderboard.slice(0, 10).forEach((score, index) => {
				const item = document.createElement('li');
				item.className = 'leaderboard-item';
				const rankClass = index < 3 ? `rank-${index + 1}` : '';
				const date = new Date(score.date).toLocaleDateString('zh-CN');
				const minutes = Math.floor(score.time / 60);
				const seconds = score.time % 60;
				const timeStr = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
				
				item.innerHTML = `
					<span class="rank ${rankClass}">${index + 1}</span>
					<div class="player-name">
						${score.name}
						<div class="player-date">${date}</div>
					</div>
					<div class="player-time">${timeStr}</div>
				`;
				
				list.appendChild(item);
			});
		}

		// å›è½¦é”®ä¿å­˜åç§°
		document.getElementById('playerNameInput').addEventListener('keypress', function(e) {
			if (e.key === 'Enter') {
				savePlayerName();
			}
		});
	</script>
</body>
</html>
				